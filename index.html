<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Bar SPEC Menu</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Bar SPEC">
<link rel="apple-touch-icon" href="images/logo.png">

<style>
    :root { --bg-sidebar: #1a1a1a; --bg-main: #252525; --accent-gold: #c5a059; --text-white: #e0e0e0; --text-gray: #888; }
    
    body { margin: 0; padding: 0; font-family: "Helvetica Neue", Arial, "YuGothic", sans-serif; background-color: var(--bg-sidebar); color: var(--text-white); height: 100vh; overflow: hidden; display: flex; }

    /* サイドバー：スクショの黒×ゴールドを再現 */
    .sidebar { width: 140px; background-color: var(--bg-sidebar); display: flex; flex-direction: column; flex-shrink: 0; padding-top: 20px; border-right: 1px solid #333; }
    .tab-link { display: block; text-decoration: none; padding: 20px 15px; color: var(--text-gray); font-size: 0.95rem; border-bottom: 1px solid #2a2a2a; transition: 0.3s; }
    .tab-link.active { background-color: var(--accent-gold); color: #000; font-weight: bold; }

    /* メインエリア */
    .main-area { flex: 1; background-color: var(--bg-main); display: flex; flex-direction: column; overflow: hidden; }

    /* ヘッダーと言語ボタン */
    .header { padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
    .page-title { margin: 0; font-size: 1.8rem; color: var(--accent-gold); font-family: "YuMincho", serif; }
    .lang-btns { display: flex; gap: 4px; }
    .lang-btn { background: #333; border: none; color: #888; padding: 5px 10px; cursor: pointer; border-radius: 4px; font-size: 0.75rem; font-weight: bold; }
    .lang-btn.active { background: #f0cc5e; color: #000; }

    /* ソートバー：スクショ通り銘柄名と価格を左右に配置 */
    .sort-bar { background: #1a1a1a; padding: 8px 30px; display: flex; justify-content: space-between; font-size: 0.8rem; color: #666; border-bottom: 1px solid #333; }
    .sort-btn { cursor: pointer; display: flex; align-items: center; gap: 4px; }

    /* リストエリア */
    .content-scroll { flex: 1; overflow-y: auto; padding: 0 30px 40px 30px; }
    .item-entry { border-bottom: 1px solid #333; padding: 20px 0; display: flex; justify-content: space-between; align-items: flex-start; }
    
    /* カード形式（画像あり） */
    .item-card { display: flex; gap: 15px; }
    .item-img { width: 160px; height: 110px; object-fit: cover; border-radius: 6px; border: 1px solid #444; }
    
    .item-text h3 { margin: 0; font-size: 1.15rem; color: var(--text-white); font-weight: normal; }
    .item-sub { font-size: 0.8rem; color: var(--text-gray); margin-top: 4px; }
    .item-desc { font-size: 0.8rem; color: var(--text-gray); margin-top: 8px; line-height: 1.4; }
    .item-price { color: var(--accent-gold); font-size: 1.15rem; font-weight: bold; margin-left: 20px; }

    /* 特集ページ（図鑑）用のスタイル */
    .knowledge-item { margin-bottom: 40px; }
    .knowledge-img { width: 100%; border-radius: 8px; margin-top: 15px; }

    /* モーダル */
    .info-icon { display: inline-block; width: 20px; height: 20px; line-height: 20px; text-align: center; border: 1px solid var(--accent-gold); color: var(--accent-gold); border-radius: 50%; font-size: 0.7rem; margin-left: 8px; cursor: pointer; }
    .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 2000; justify-content: center; align-items: center; }
    .modal-content { background: #252525; border-top: 4px solid var(--accent-gold); padding: 30px; width: 85%; max-width: 600px; border-radius: 12px; position: relative; }
    .modal-close { position: absolute; top: 10px; right: 20px; color: #888; font-size: 2rem; cursor: pointer; }
</style>
</head>
<body>

<nav class="sidebar">
    <a href="#recommend" class="tab-link" id="link-recommend">おすすめ</a>
    <a href="#whisky" class="tab-link" id="link-whisky">ウイスキー</a>
    <a href="#spirits" class="tab-link" id="link-spirits">SPIRITS</a>
    <a href="#beer" class="tab-link" id="link-beer">BEER</a>
    <a href="#wine" class="tab-link" id="link-wine">WINE</a>
    <a href="#food" class="tab-link" id="link-food">フード</a>
    <a href="#knowledge" class="tab-link" id="link-knowledge">図鑑・知識</a>
</nav>

<main class="main-area">
    <div class="header">
        <h2 class="page-title" id="page-title">おすすめ</h2>
        <div class="lang-btns">
            <button class="lang-btn active" onclick="setLang('jp')">JP</button>
            <button class="lang-btn" onclick="setLang('en')">EN</button>
            <button class="lang-btn" onclick="setLang('ko')">KO</button>
            <button class="lang-btn" onclick="setLang('zh')">ZH</button>
            <button class="lang-btn" onclick="setLang('es')">ES</button>
        </div>
    </div>

    <div class="sort-bar" id="sort-bar">
        <div class="sort-btn" onclick="toggleSort('name')">銘柄名 <span id="icon-name">▲</span></div>
        <div class="sort-btn" onclick="toggleSort('price')">価格 <span id="icon-price">⇅</span></div>
    </div>

    <div class="content-scroll" id="main-content"></div>
</main>

<div id="modal-overlay" class="modal-overlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <span class="modal-close" onclick="closeModal()">&times;</span>
        <h2 id="modal-title" style="color:var(--accent-gold); margin-top:0;"></h2>
        <div id="modal-body" style="white-space:pre-wrap; color:#ccc; line-height:1.8;"></div>
    </div>
</div>

<script src="menu_data.js" charset="UTF-16"></script>
<script>
    if (sessionStorage.getItem("isLoggedIn") !== "true") { window.location.href = "login.html"; }

    let state = { category: "recommend", lang: "jp", sort: { key: 'name', direction: 1 } };
    const labels = {
        jp: { recommend: "おすすめ", whisky: "ウイスキー", spirits: "SPIRITS", beer: "BEER", wine: "WINE", food: "フード", knowledge: "図鑑・知識" },
        en: { recommend: "Recommend", whisky: "Whisky", spirits: "Spirits", beer: "Beer", wine: "Wine", food: "Food", knowledge: "Knowledge" }
    };

    function setLang(l) {
        state.lang = l;
        document.querySelectorAll('.lang-btn').forEach(btn => btn.classList.toggle('active', btn.innerText.toLowerCase() === l));
        renderPage();
    }

    function toggleSort(key) {
        if (state.sort.key === key) state.sort.direction *= -1;
        else { state.sort.key = key; state.sort.direction = 1; }
        renderPage();
    }

    window.addEventListener('hashchange', () => { state.category = window.location.hash.replace('#','') || 'recommend'; renderPage(); });
    window.addEventListener('load', () => { state.category = window.location.hash.replace('#','') || 'recommend'; renderPage(); });

    function showModal(name, note) {
        document.getElementById('modal-title').innerText = name;
        document.getElementById('modal-body').innerText = note;
        document.getElementById('modal-overlay').style.display = 'flex';
    }
    function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

    function renderPage() {
        const container = document.getElementById('main-content');
        const items = menuData.filter(i => i.category === state.category);
        
        // サイドバーとタイトルの更新
        document.querySelectorAll('.tab-link').forEach(l => {
            const cat = l.id.replace('link-','');
            l.classList.toggle('active', cat === state.category);
            l.innerText = (labels[state.lang] && labels[state.lang][cat]) || (i18n[state.lang] && i18n[state.lang][cat]) || cat.toUpperCase();
        });
        document.getElementById('page-title').innerText = (labels[state.lang] && labels[state.lang][state.category]) || state.category.toUpperCase();

        // 特集ページ（図鑑）の表示
        if (state.category === 'knowledge') {
            document.getElementById('sort-bar').style.display = 'none';
            container.innerHTML = items.map(item => `
                <div class="knowledge-item">
                    <h3>${item[`name_${state.lang}`] || item.name_jp}</h3>
                    <img src="${item.image}" class="knowledge-img" onerror="this.src='images/no-image.png'">
                    <p class="item-desc">${item[`desc_${state.lang}`] || item.desc_jp}</p>
                </div>
            `).join('');
            return;
        }
        document.getElementById('sort-bar').style.display = 'flex';

        // ソート処理
        items.sort((a, b) => {
            let vA = a[state.sort.key === 'name' ? `name_${state.lang}` : 'price'] || a['name_jp'];
            let vB = b[state.sort.key === 'name' ? `name_${state.lang}` : 'price'] || b['name_jp'];
            return (typeof vA === 'string' ? vA.localeCompare(vB) : vA - vB) * state.sort.direction;
        });

        document.getElementById('icon-name').innerText = state.sort.key === 'name' ? (state.sort.direction===1?'▲':'▼') : '⇅';
        document.getElementById('icon-price').innerText = state.sort.key === 'price' ? (state.sort.direction===1?'▲':'▼') : '⇅';

        container.innerHTML = items.map(item => {
            const name = item[`name_${state.lang}`] || item.name_jp;
            const sub = (state.lang === 'jp') ? item.name_en : item.name_jp;
            const desc = item[`desc_${state.lang}`] || item.desc_jp || '';
            const info = item.note_jp ? `<span class="info-icon" onclick="showModal('${name}', \`${item.note_jp}\`)">i</span>` : '';
            
            if (item.image) {
                return `
                    <div class="item-entry">
                        <div class="item-card">
                            <img src="${item.image}" class="item-img" onerror="this.src='images/no-image.png'">
                            <div class="item-text">
                                <h3>${name}${info}</h3>
                                <div class="item-sub">${sub}</div>
                                <div class="item-desc">${desc}</div>
                            </div>
                        </div>
                        <div class="item-price">¥${item.price.toLocaleString()}</div>
                    </div>`;
            } else {
                return `
                    <div class="item-entry">
                        <div class="item-text">
                            <h3>${name}${info}</h3>
                            <div class="item-sub">${sub}</div>
                            <div class="item-desc">${desc}</div>
                        </div>
                        <div class="item-price">¥${item.price.toLocaleString()}</div>
                    </div>`;
            }
        }).join('');
    }
</script>
</body>
</html>